<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>스프라이트 애니메이션 뷰어</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: sans-serif;
      background: #fff;
      color: #000;
      display: flex;
      height: 100vh;
    }

    #controls {
      width: 300px;
      padding: 30px;
    }

    #controls label {
      display: block;
      margin-top: 15px;
    }

    #controls input {
      width: 80px;
      margin-top: 5px;
      padding: 4px;
    }

    #sprite-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    #sprite {
      position: relative;
      image-rendering: pixelated;
      transform: scale(0.5) translate(-1000px, 500px);
      transform-origin: top center;
    }

    h1 {
      font-size: 16px;
      line-height: 1.5;
      margin: 20px 0;
    }

    button {
      margin-top: 15px;
      padding: 5px 15px;
    }
  </style>
</head>
<body>

  <div id="controls">
    <h1>
      재생 후 좌/우 방향키로 상태 변경<br>
      좌: Attack1, 정지: 기본, 우: Attack2<br><br>
      값 변경 후 정지 → 재생 필요
    </h1>

    <label for="speed">프레임 간격 (ms):</label>
    <input type="number" id="speed" value="100">

    <label for="floatSpeed">체공 속도 (px/sec):</label>
    <input type="number" id="floatSpeed" value="80">

    <label for="moveSpeed">이동 속도 (px/sec):</label>
    <input type="number" id="moveSpeed" value="100">

    <br>
    <button onclick="startAnimation()">재생</button>
    <button onclick="stopAnimation()">정지</button>
  </div>

  <div id="sprite-container">
    <img id="sprite" src="basics/h1.png" alt="sprite frame">
  </div>

  <script>
    let currentFrame = 0;
    let frameIntervalId = null;
    let animationFrameId = null;

    let floatY = 500;
    let directionY = 1;
    let floatSpeed = 80;
    const floatRange = 60;  // ← 체공 범위 ±60px

    let moveSpeed = 100;
    let posX = -1000;
    let moveDir = 0;

    let lastTimestamp = null;

    let spriteState = 'h'; // h = 기본, o = 왼쪽, t = 오른쪽

    const frameCounts = {
      h: 25,
      o: 10,
      t: 10
    };

    function getFolderPrefix(state) {
      switch (state) {
        case 'h': return 'basics';
        case 'o': return 'Attack1';
        case 't': return 'Attack2';
        default: return '';
      }
    }

    function buildFramePaths(prefix) {
      const folder = getFolderPrefix(prefix);
      const count = frameCounts[prefix];
      const frames = [];
      for (let i = 1; i <= count; i++) {
        frames.push(`${folder}/${prefix}${i}.png`);
      }
      return frames;
    }

    let framePaths = buildFramePaths(spriteState);

    function showFrame(index) {
      document.getElementById("sprite").src = framePaths[index];
    }

    function update(timestamp) {
      if (!lastTimestamp) lastTimestamp = timestamp;
      const delta = (timestamp - lastTimestamp) / 1000;
      lastTimestamp = timestamp;

      floatY += directionY * floatSpeed * delta;
      if (floatY > 500 + floatRange) {
        floatY = 500 + floatRange;
        directionY = -1;
      } else if (floatY < 500 - floatRange) {
        floatY = 500 - floatRange;
        directionY = 1;
      }

      posX += moveDir * moveSpeed * delta;

      const sprite = document.getElementById("sprite");
      sprite.style.transform = `scale(0.5) translate(${posX}px, ${floatY}px)`;

      animationFrameId = requestAnimationFrame(update);
    }

    function startAnimation() {
      stopAnimation();

      const frameSpeed = parseInt(document.getElementById("speed").value);
      floatSpeed = parseFloat(document.getElementById("floatSpeed").value);
      moveSpeed = parseFloat(document.getElementById("moveSpeed").value);

      framePaths = buildFramePaths(spriteState);
      frameIntervalId = setInterval(() => {
        currentFrame = (currentFrame + 1) % framePaths.length;
        showFrame(currentFrame);
      }, frameSpeed);

      lastTimestamp = null;
      animationFrameId = requestAnimationFrame(update);
    }

    function stopAnimation() {
      if (frameIntervalId !== null) clearInterval(frameIntervalId);
      if (animationFrameId !== null) cancelAnimationFrame(animationFrameId);

      posX = -1000;
      floatY = 500;
      moveDir = 0;
      directionY = 1;
      currentFrame = 0;
      spriteState = 'h';
      framePaths = buildFramePaths(spriteState);
      showFrame(0);

      document.getElementById("sprite").style.transform = `scale(0.5) translate(${posX}px, ${floatY}px)`;
    }

    function setSpriteState(newState) {
      if (spriteState !== newState) {
        spriteState = newState;
        framePaths = buildFramePaths(spriteState);
        currentFrame = 0;
        showFrame(currentFrame);
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight") {
        moveDir = 1;
        setSpriteState('t');
      } else if (e.key === "ArrowLeft") {
        moveDir = -1;
        setSpriteState('o');
      }
    });

    document.addEventListener("keyup", (e) => {
      if ((e.key === "ArrowRight" && moveDir === 1) ||
          (e.key === "ArrowLeft" && moveDir === -1)) {
        moveDir = 0;
        setSpriteState('h');
      }
    });
  </script>

</body>
</html>
